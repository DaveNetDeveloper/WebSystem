<!doctype html>
<html class="no-js" lang="es">
<head>

    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="login">
    <meta name="description" content="Página para iniciar sesión con una cuenta de usuario existente.">
    <meta name='copyright' content='UOC'>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Login</title>

    <link rel="icon" href="img/favicon.png">

    <script src="../WebPages/js/jquery.min.js"></script>
    <script src="../WebPages/js/jquery-migrate-3.0.0.js"></script>
    <script src="../WebPages/js/jquery-ui.min.js"></script>
    <script src="../WebPages/js/easing.js"></script>
    <script src="../WebPages/js/colors.js"></script>
    <!--<script src="../WebPages/js/popper.min.js"></script>
    <script src="../WebPages/js/bootstrap-datepicker.js"></script>-->
    <script src="../WebPages/js/jquery.nav.js"></script>
    <!--<script src="../WebPages/js/slicknav.min.js"></script>
    <script src="../WebPages/js/jquery.scrollUp.min.js"></script>-->
    <script src="../WebPages/js/niceselect.js"></script>
    <script src="../WebPages/js/tilt.jquery.min.js"></script>
    <!--<script src="../WebPages/js/owl-carousel.js"></script>-->
    <script src="../WebPages/js/jquery.counterup.min.js"></script>
    <script src="../WebPages/js/steller.js"></script>
    <script src="../WebPages/js/wow.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.3/waypoints.min.js"></script>
    <script src="https://maps.google.com/maps/api/js?key=AIzaSyDGqTyqoPIvYxhn_Sa7ZrK5bENUWhpCo0w"></script>
    <script src="../WebPages/js/gmaps.min.js"></script>
    <script src="../WebPages/js/map-active.js"></script>-->
    <script src="../WebPages/js/bootstrap.min.js"></script>

    <script src="../WebPages/js/libraries/globalAuth.js"></script>

    <!--<link rel="stylesheet" href="../WebPages/css/bootstrap.min.css">
    <link rel="stylesheet" href="../WebPages/css/nice-select.css">
    <link rel="stylesheet" href="../WebPages/css/font-awesome.min.css">
    <link rel="stylesheet" href="../WebPages/css/icofont.css">
    <link rel="stylesheet" href="../WebPages/css/slicknav.min.css">
    <link rel="stylesheet" href="../WebPages/css/owl-carousel.css">
    <link rel="stylesheet" href="../WebPages/css/datepicker.css">
    <link rel="stylesheet" href="../WebPages/css/animate.min.css">
    <link rel="stylesheet" href="../WebPages/css/normalize.css">
    <link rel="stylesheet" href="../WebPages/css/style.css">
    <link rel="stylesheet" href="../WebPages/css/responsive.css">-->

</head>
<body>

    <header class="header">
        <div class="header-inner">
            <div class="container">
                <div class="inner" style="padding: 18px;">
                    <div class="row" style="margin-left: 48%;">
                        <div>
                            <div class="logo">
                                <a href="home-publica.html"><img src="../../WebPages/img/logo.jpg" alt="#"></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <app-login login-type="Web" is-qr-login="false"></app-login>
    <script type="module" src="../Components/login/login.js"></script>

    <!--<button id="btnPrueba">Probar Endpoint Seguro</button>-->

    <script>

        //function getCookie(nombre) {
        //    const nombreEQ = nombre + "=";
        //    const cookies = document.cookie.split(';');
        //    for (let i = 0; i < cookies.length; i++) {
        //        let cookie = cookies[i];
        //        while (cookie.charAt(0) === ' ') {
        //            cookie = cookie.substring(1, cookie.length);
        //        }
        //        if (cookie.indexOf(nombreEQ) === 0) {
        //            return decodeURIComponent(cookie.substring(nombreEQ.length, cookie.length));
        //        }
        //    }
        //    return null;
        //}

        //async function llamarEndpointSeguro() {
        //    try {
        //        const token = getCookie('app-access-token');
        //        if (!token) throw new Error('No se encontró el token. Inicia sesión primero.');

        //        const baseUrl = `https://localhost`;
        //        const port = `44311`;
        //        const apiUrl = `${baseUrl}:${port}/Usuarios/ObtenerUsuarios`;

        //        const res = await fetchWithAuth(apiUrl, {
        //            method: 'GET',
        //            headers: {
        //                'Content-Type': 'application/json',
        //                'Authorization': `Bearer ${token}`
        //            }
        //            //, body: JSON.stringify({ foo: 'bar' })
        //        });
        //        if (!res.ok) {
        //            //alert("Error en WebPages/Login.html");
        //            throw new Error('Error al llamar al endpoint seguro');
        //        }

        //        return await res.json();
        //    }
        //    catch (err) {
        //        console.error(err);
        //        throw err;
        //    }
        //}

        //document.getElementById('btnPrueba').addEventListener('click', async () => {
        //    try {
        //        const usuarios = await llamarEndpointSeguro();
        //        console.log('Usuarios desde botón:', usuarios);
        //        alert('Revisa la consola para ver los usuarios');

        //    }
        //    catch (error) {
        //        console.error('Error al llamar al endpoint:', error);
        //        alert('Error al llamar al endpoint seguro. Revisa la consola para ver los errores');
        //    }
        //});

        document.querySelector('app-login') // Escucha el evento emitido por el componente
            .addEventListener('login-success', (e) => {

                // Cokkie data
                //alert("Cokkie " + getCookie('app-access-token'));
                //alert("Cokkie " + getCookie('app-refresh-token'));
                //alert("Cokkie " + getCookie('app-role'));
                //alert("Cokkie " + getCookie('app-profile'));

                localStorage.setItem("idUsuario", e.detail.idUsuario);
               // alert(e.detail.idUsuario);

                //const usuarios = llamarEndpointSeguro();
                //console.log('Usuarios:', usuarios);
                //alert('Revisa la consola para ver los usuarios');

                window.location.href = '../WebPages/home-privada.html';
            });

    </script>

    <script type="module">

        import {
            baseUrl, port, loadGlobalConfiguration
        } from "../WebPages/js/libraries/appConfiguration.js";

        async function init() {
            await loadGlobalConfigurationFromConfig();

            window.baseUrl = baseUrl;
            window.port = port;
             
            //alert(baseUrl);
            //alert(port);

        }
        init();
    </script>


</body>
</html>
