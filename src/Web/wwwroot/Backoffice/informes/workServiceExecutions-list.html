<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Informes / Ejecuciones de WorkServices</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!--<link rel="manifest" href="../site.webmanifest">-->
		<link rel="shortcut icon" type="image/x-icon" href="../img/favicon.png">
        <!-- Place favicon.png in the root directory -->
         
        <link rel="stylesheet" href="../css/bootstrap.min.css"> 
        <link rel="stylesheet" href="../css/animate.min.css"> 
        <link rel="stylesheet" href="../css/fontawesome-all.min.css">
        <link rel="stylesheet" href="../css/et-line-fonts.css">
        <link rel="stylesheet" href="../css/themify-icons.css"> 
        <link rel="stylesheet" href="../css/default.css">
        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/responsive.css">
    </head>
    <body>
        <div class="body-wrapper body-bg">
            <header>
                <admin-menu is-home="false"></admin-menu>
                <script type="module" src="../Components/adminHeader/adminHeader.js"></script>
            </header>
            <script>
                window.GlobalCssCache = {};
                async function preloadCss(path) {
                    if (!window.GlobalCssCache[path]) {
                        const css = await fetch(path).then(r => r.text());
                        window.GlobalCssCache[path] = css;
                    }
                    return window.GlobalCssCache[path];
                }
            </script>

            <div class="dashboard-area pt-30">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="pannel-wrapper white-bg mb-30">
                                <div class="panel-heading heading-border">
                                    <h4>Ejecuciones de WorkServices</h4>
                                </div>
                                <div class="panel-body p-0">
                                    <div class="table-responsive">
                                        <table id="paymentsTable" class="table mb-0">
                                            <thead class="gray-bg">
                                                <tr>
                                                    <th scope="col">Id</th>
                                                    <th scope="col">Worker Service</th>
                                                    <th scope="col">Fecha de Ejecución</th>
                                                    <th scope="col">Resultado</th>
                                                </tr>
                                            </thead>
                                            <tbody id="payments-body">
                                                <!--  Contenido dinamico -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                const tbody = document.getElementById("payments-body");

                try {

                    const baseUrl = window.location.hostname === "localhost"
                        ? "https://localhost"
                        : "https://websystem-api-prod-ctgrd4gfc2e6dudb.westeurope-01.azurewebsites.net";

                    const port = window.location.hostname === "localhost"
                        ? "44311"
                        : "";
                    const controllerName = `WorkerServiceExecution`;
                    //const port = `44311`;
                    const apiUrl = `${baseUrl}:${port}/${controllerName}/ObtenerWorkerServiceExecutions`;

                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error("Error al obtener los datos");

                    const data = await response.json();

                    tbody.innerHTML = "";

                    data.forEach((item) => {
                        const row = document.createElement("tr");

                        // Clase del botón según estado
                        let statusClass = "btn-secondary";
                        if (item.result === "Passed") statusClass = "btn-success";
                        else if (item.result === "Failed") statusClass = "btn-danger";
                        else statusClass = "btn-warning";

                        row.innerHTML = `
                                  <td>#${item.id}</td>
                                  <td>${item.workerService}</td>
                                  <td>$${item.executionTime}</td>
                                  <td>
                                    <button type="button" class="btn ${statusClass} btn-sm d-block">
                                      ${item.result}
                                    </button>
                                  </td> `;

                        tbody.appendChild(row);
                    });
                } catch (error) {
                    console.error("Error al cargar los datos:", error);
                    tbody.innerHTML =
                        '<tr><td colspan="5" class="text-center text-danger">No se pudieron cargar los datos</td></tr>';
                }
            });
        </script>

        <script src="../js/vendor/modernizr-3.5.0.min.js"></script>
        <script src="../js/vendor/jquery-1.12.4.min.js"></script>
        <script src="../js/popper.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script src="../js/plugins.js"></script>
        <script src="../js/main.js"></script>

    </body>
</html>