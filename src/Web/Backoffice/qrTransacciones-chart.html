<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Reports / Transacciones QR</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="manifest" href="site.webmanifest">
		<link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">
 
        <link rel="stylesheet" href="css/bootstrap.min.css">  
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/et-line-fonts.css"> 
        <link rel="stylesheet" href="css/chart.css">
        <link rel="stylesheet" href="css/default.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
    </head>
    <body>
        <div class="body-wrapper body-bg">
            <header>
            </header>

            <div class="dashboard-area pt-30">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="pannel-wrapper white-bg mb-30">
                                <div class="panel-heading heading-border">
                                    <h4>Reports / Transacciones QR</h4>
                                </div>
                                <div class="panel-body mt-30 pt-0">
                                    <div class="chart-js-warpper">
                                        <div class="flot-js-warpper">
                                            <div id="flot-bars" style="height: 250px">
                                                <!--  Contenido dinamico -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <script src="js/vendor/modernizr-3.5.0.min.js"></script>
        <script src="js/vendor/jquery-1.12.4.min.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/flot.js"></script>

        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                var gridColor = "#aaaaaa";
                var gridBorder = "#eeeeee";
                var legendBg = "#f5f5f5";

                const baseUrl = `https://localhost`;
                const controllerName = `DataQuery`;
                const port = `44311`;
                const apiUrl = `${baseUrl}:${port}/${controllerName}/ObtenerTotalUltimasTransacciones`;

                if ($("#flot-bars").length) {
                    try {
                        const response = await fetch(apiUrl);
                        const result = await response.json();

                        // Construimos los arrays de datos para Flot
                        const dataQR = [];
                        const dataTotal = [];

                        result.forEach((row, index) => {
                            dataQR.push([index + 1, row.totalQR]);
                            dataTotal.push([index + 1, row.totalTransacciones]);
                        });

                        $.plot(
                            $("#flot-bars"),
                            [
                                { label: "Total Transacciones", data: dataTotal },
                                { label: "Transacciones QR", data: dataQR }
                            ],
                            {
                                series: {
                                    shadowSize: 0,
                                    bars: {
                                        show: true,
                                        barWidth: 0.3,
                                        align: "center",
                                        lineWidth: 1,
                                        fill: 0.5
                                    }
                                },

                                grid: {
                                    color: gridColor,
                                    borderColor: gridBorder,
                                    borderWidth: 1,
                                    hoverable: true,
                                    clickable: true
                                },

                                xaxis: {
                                    tickDecimals: 0,
                                    tickColor: gridBorder,
                                    ticks: result.map((row, index) => [index + 1, `${index + 1}`])
                                },
                                yaxis: {
                                    tickColor: gridBorder
                                },

                                legend: { backgroundColor: legendBg },
                                tooltip: { show: true },
                                tooltipOpts: {
                                    content: "DÃ­a: %x | Y: %y"
                                },
                                colors: ["#FF5722", "#0288D1"]
                            }
                        );
                    } catch (error) {
                        console.error("Error cargando datos:", error);
                    }
                }
            }); 
        </script>
         
    </body>
</html>