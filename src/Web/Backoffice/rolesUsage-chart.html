<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title> Charts / Role Usage </title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="manifest" href="site.webmanifest">
		<link rel="shortcut icon" type="image/x-icon" href="img/favicon.png"> 

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/animate.min.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/et-line-fonts.css">
        <link rel="stylesheet" href="css/chart.css">
        <link rel="stylesheet" href="css/default.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
    </head>
    <body>

        <div class="body-wrapper body-bg">
            <header>
            </header>

            <!-- dashboard-area start -->
            <div class="dashboard-area pt-30">
                <div class="container">
                    <div class="row">

                        <div class="col-lg-12">
                            <div class="pannel-wrapper white-bg mb-30">
                                <div class="panel-heading heading-border">
                                    <h4>Charts / Role Usage</h4>
                                </div>
                                <div class="panel-body mt-30 pt-0">
                                    <div class="chart-js-warpper">
                                        <canvas id="chart-pie" height="250" class="chartjs-demo"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <br /><br /><br /><br /><br />


            <footer>
                <div class="footer-area">
                    <div class="container">
                        <div class="copyright white-bg pt-25 pb-25 text-center">
                            <p>Copyright © 2025 Slabo. All rights reserved. Design by David Martínez.</p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <script src="js/vendor/jquery-1.12.4.min.js"></script>
        <script src="js/Chart.bundle.js"></script>
        <script type="text/javascript">

            $(function () {
                $(".chartjs-demo").each(function () {
                    $(this).wrap(
                        $('<div style="height:' + this.getAttribute("height") + 'px"></div>')
                    ); 
                });

                if ($("#chart-pie").length) {
                   
                    const baseUrl = `https://localhost`;
                    const controllerName = `DataQuery`;
                    const port = `44311`;
                    const apiUrl = `${baseUrl}:${port}/${controllerName}/ObtenerRolesUsuarios`;

                    fetch(apiUrl)
                        .then(response => response.json())
                        .then(data => {
                            const labels = data.map(item => item.rol);
                            const values = data.map(item => item.rolUsage);

                            const backgroundColors = [
                                "#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0",
                                "#9966FF", "#FF9F40", "#8DD17E", "#F06292"
                            ];
                            const hoverColors = backgroundColors.map(c => c);

                            // Crear el gráfico
                            var pieChart = new Chart(
                                document.getElementById("chart-pie").getContext("2d"),
                                {
                                    type: "pie",
                                    data: {
                                        labels: labels,
                                        datasets: [ {
                                                data: values,
                                                backgroundColor: backgroundColors.slice(0, labels.length),
                                                hoverBackgroundColor: hoverColors.slice(0, labels.length)
                                            } ]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: {
                                            legend: {
                                                position: "bottom"
                                            },
                                            tooltip: {
                                                callbacks: {
                                                    label: function (context) {
                                                        return context.label + ": " + context.formattedValue;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            );
                        })
                        .catch(error => console.error("Error cargando gráfico:", error));
                }
            });
        </script>
        <!--<script src="js/vendor/modernizr-3.5.0.min.js"></script>-->
        <!--<script src="js/popper.min.js"></script>-->
        <!--<script src="js/bootstrap.min.js"></script>-->
        <!--<script src="js/plugins.js"></script>-->
        <!--<script src="js/chartjs.js"></script>-->
    </body>
</html>