<!doctype html>
<html class="no-js" lang="es">
<head>
    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="registro">
    <meta name="description" content="Página para crear una nueva cuenta de usuario.">
    <meta name='copyright' content='UOC'>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Registro</title>

    <link rel="icon" href="img/favicon.png">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <!-- Nice Select CSS -->
    <link rel="stylesheet" href="./css/nice-select.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="./css/font-awesome.min.css">
    <!-- icofont CSS -->
    <link rel="stylesheet" href="./css/icofont.css">
    <!-- Slicknav -->
    <link rel="stylesheet" href="./css/slicknav.min.css">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="./css/owl-carousel.css">
    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="./css/datepicker.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="./css/animate.min.css">
    <!-- Magnific Popup CSS -->
    <link rel="stylesheet" href="./css/magnific-popup.css">
    <!-- Site CSS -->
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/responsive.css">

    <!-- Js Sripts -->
    <script src="./js/services/usuariosController.js"></script>
    <script src="./js/libraries/utilities.js"></script>
    <script src="./js/services/correoController.js"></script>
    <script src="./js/services/transaccionesController.js"></script>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="loader">
            <div class="loader-outter"></div>
            <div class="loader-inner"></div>
            <div class="indicator">
                <svg width="16px" height="12px">
                    <polyline id="back" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                    <polyline id="front" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                </svg>
            </div>
        </div>
    </div>
    <!-- End Preloader -->
    <!-- Contenedor para el encabezado -->
    <!--<div id="headerContainer"></div>-->
    <!-- Header Area -->
    <header class="header">
        <!-- Header Inner -->
        <div class="header-inner">
            <div class="container">
                <div class="inner" style="padding: 18px;">
                    <div class="row" style="margin-left: 48%;">
                        <div>
                            <!-- Start Logo -->
                            <div class="logo">
                                <a href="home-publica.html"><img src="img/logo.jpg" alt="#"></a>
                            </div>
                            <!-- End Logo -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="banner">
                <h1 id="h1Login" style="font-size: 20px;"></h1>
            </div>
        </div>
        <!--/ End Header Inner -->
    </header>
    <!-- End Header Area -->

    <!-- Start Section -->
    <section class="contact-us section">
        <div class="container">
            <div class="inner">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="contact-us-form">
                            <h2>Únete</h2>
                            <p>Crear tu cuenta y consigue 300 puntos de bienvenida.</p>
                            <!-- Form -->
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <input type="email" name="email" placeholder="Email" required value="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <input type="password" name="password" placeholder="Contraseña" required value="password">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <input type="text" name="name" placeholder="Nombre" required value="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <input type="text" name="surname" placeholder="Apellidos" required value="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <input style="width: 180px;" type="date" name="date" placeholder="Fecha de nacimiento" required value="02-11-2023">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="">
                                        <label class="checkbox-inline" for="1"><input style="margin-top: 15px;" checked="checked" name="tc" id="1" type="checkbox">  He leído y acepto los Términos y Condiciones.</label>
                                    </div>
                                    <div class="">
                                        <label class="checkbox-inline" for="2"><input name="suscribe" id="2" type="checkbox">  Suscríbete para recibir nuestra newletter con noticias y promociones.</label>
                                    </div>
                                    <div class="form-group login-btn" style="margin-top: 20px;">
                                        <button class="btn" type="submit" name="btnRegistro">REGÍSTRATE</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/ End Form -->
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--/ End Section -->
    <!-- Contenedor para el footer -->
    <div id="footerContainer"></div>

    <!-- Scripts -->
    <script type="text/javascript">
        // cargarContenidoHtml('header.html', 'headerContainer');
        cargarContenidoHtml('footer.html', 'footerContainer');
    </script>

    <script type="text/javascript">

        //var emailValue = getInputValueByName('email');
        //var passwordValue = getInputValueByName('password');

        //setInputValueByName('email', 'david@correo.com');
        //setInputValueByName('password', 'nuevaPassword!');

    </script>

    <script type="text/javascript">

        /*Validaciones de los campos del formulario*/
        function validateNewUser(newUser) {

            if (!validateTermsAndConsitions()) return false;
            if (!validateName(newUser.nombre)) return false;
            if (!validateSurname(newUser.apellidos)) return false;
            if (!validateEmail(newUser.email)) return false;
            if (!validatePassword(newUser.contraseña)) return false;
            if (!validateDate(newUser.fechaNacimiento)) return false;

            return true;
        }

        function validatePassword(password) {

            return true;
        }

        function validateDate(date) {

            return true;
        }

        function validateEmail(email) {

            return true;
        }

        function validateName(name) {

            return true;
        }

        function validateSurname(surname) {

            return true;
        }

        function validateTermsAndConsitions() {
            return getCheckboxValueByName('tc');
        }

        function getFormUser() {
            //
            var formUser = new Usuario(
                null,
                getInputValueByName('name'),
                getInputValueByName('surname'),
                getInputValueByName('email'),
                false,
                getInputValueByName('password'),
                getInputValueByName('date'),
                getCheckboxValueByName('suscribe'),
                getCurrentDateTime(),
                null);
            return formUser;
        }

        function crearTransaccion(idUser) {

            return new Transaccion(
                null,
                "Puntos de bienvenida",
                idUser,
                null,
                300,
                null);
        }

    </script>

    <script type="text/javascript">

        function onClickBtnRegistro() {

            var newUser = getFormUser();
            if (validateNewUser(newUser)) {

                var newPassword = new Date().toLocaleString();
                calcularHash(newPassword).then(hash => {

                    newUser.contraseña = hash;
                    Post('CrearUsuario', newUser)
                        .then(data => {

                            var transaccion = crearTransaccion(data.id);
                            PostTransaccion("CrearTransaccion", transaccion)
                                .then(t => {
                                    enviarCorreo(newUser.correo, 0); // ValidaciónCuenta
                                    redirectToPage('registerConfirmation.html?email=' + newUser.correo);
                                })
                                .catch(error => {
                                    console.error('Error fuera de la función PostTransaccion:', error);
                                });
                        })
                        .catch(error => {
                            console.error('Error fuera de la función CrearUsuario:', error);
                        });
                });
            }
            else {
                //
                alert('Hay errores de validación');
            }
        }

        const btnRegistro = document.querySelector('button[name="btnRegistro"]');
        btnRegistro.addEventListener('click', onClickBtnRegistro);

    </script>

    <!-- Load Scripts -->
    <!-- jquery Min JS -->
    <script src="./js/jquery.min.js"></script>
    <!-- jquery Migrate JS -->
    <script src="./js/jquery-migrate-3.0.0.js"></script>
    <!-- jquery Ui JS -->
    <script src="./js/jquery-ui.min.js"></script>
    <!-- Easing JS -->
    <script src="./js/easing.js"></script>
    <!-- Color JS -->
    <script src="./js/colors.js"></script>
    <!-- Popper JS -->
    <script src="./js/popper.min.js"></script>
    <!-- Bootstrap Datepicker JS -->
    <script src="./js/bootstrap-datepicker.js"></script>
    <!-- Jquery Nav JS -->
    <script src="./js/jquery.nav.js"></script>
    <!-- Slicknav JS -->
    <script src="./js/slicknav.min.js"></script>
    <!-- ScrollUp JS -->
    <script src="./js/jquery.scrollUp.min.js"></script>
    <!-- Niceselect JS -->
    <script src="./js/niceselect.js"></script>
    <!-- Tilt Jquery JS -->
    <script src="./js/tilt.jquery.min.js"></script>
    <!-- Owl Carousel JS -->
    <script src="./js/owl-carousel.js"></script>
    <!-- counterup JS -->
    <script src="./js/jquery.counterup.min.js"></script>
    <!-- Steller JS -->
    <script src="./js/steller.js"></script>
    <!-- Wow JS -->
    <script src="./js/wow.min.js"></script>
    <!-- Magnific Popup JS -->
    <script src="./js/jquery.magnific-popup.min.js"></script>
    <!-- Counter Up CDN JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.3/waypoints.min.js"></script>
    <!-- Google Map API Key JS -->
    <script src="https://maps.google.com/maps/api/js?key=AIzaSyDGqTyqoPIvYxhn_Sa7ZrK5bENUWhpCo0w"></script>
    <!-- Gmaps JS -->
    <script src="./js/gmaps.min.js"></script>
    <!-- Map Active JS -->
    <script src="./js/map-active.js"></script>
    <!-- Bootstrap JS -->
    <script src="./js/bootstrap.min.js"></script>
    <!-- Main JS -->
    <script src="./js/main.js"></script>
</body>
</html>