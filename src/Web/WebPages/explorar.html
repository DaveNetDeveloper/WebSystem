<!doctype html>
<html class="no-js" lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="TODO">
    <meta name="description" content="explorar">
    <meta name='copyright' content='TODO'>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Explorar entidades</title>

    <link rel="icon" href="img/favicon.png">

    <link href="https://fonts.googleapis.com/./css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/nice-select.css">
    <link rel="stylesheet" href="./css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/icofont.css">
    <link rel="stylesheet" href="./css/slicknav.min.css">
    <link rel="stylesheet" href="./css/owl-carousel.css">
    <link rel="stylesheet" href="./css/datepicker.css">
    <link rel="stylesheet" href="./css/animate.min.css">
    <link rel="stylesheet" href="./css/magnific-popup.css">

    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/responsive.css">

    <script src="./js/services/entidadesController.js"></script>
    <script src="./js/libraries/header.js"></script>
    <script src="./js/libraries/footer.js"></script>

    <style>
        /*.filter-pills {
                    display: flex;
                    gap: 10px;
                    margin-bottom: 10px;
                }

                .filter-pill {
                    background-color: goldenrod;
                    padding: 5px 10px;
                    border-radius: 20px;
                    display: flex;
                    align-items: center;
                    margin-top: 20px;
                    width: min-content;
                    color: black;
                }

                    .filter-pill button {
                        margin-left: 5px;
                        cursor: pointer;
                        background: transparent;
                    }*/

        /*
         * Asegura el estilo inactivo base (dashed, borde, texto de color)
         */
        /*.button.border-theme {
            background-color: transparent;
            border: 2px solid var(--color-theme-base);
            color: var(--color-theme-base);
            border-style: dashed;
        }*/

        /*
         * Estilo Hover (border-hover-theme) cuando el botón está inactivo.
         */
        .button.border-theme:hover,
        .button.border-hover-theme:hover {
            background-color: goldenrod;
            border-color: lightgray;
            color: white;
            cursor: pointer;
        }

        .button.hard-shadow, button.hard-shadow {
            border-bottom: 3px solid rgba(0, 0, 0, .15);
        }

        .center .button, .center button, .center-on-mobile .button, .center-on-mobile button {
            margin-right: .5rem;
            margin-left: .5rem;
        }

        .button {
            text-transform: none;
        }

        .bkg-theme {
            background-color: goldenrod;
            border-color: lightgray;
        }

        .color-hover-white:hover, .color-white {
            color: #fff;
        }

        .button, button {
            padding: 1.3rem 2.5rem;
            margin: 0 1rem 1rem 0;
            font-family: inherit;
            font-size: 1.3rem;
            color: #666;
            background-color: #eee;
            border: 1px solid #eee;
            font-weight: 400;
            vertical-align: middle;
            cursor: pointer;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .button, .button-content > span, button {
            display: inline-block;
        }

        .button, button, input, select {
            line-height: 1.4;
        }

        a, p a, .box a:not(.button) {
            color: #0cbacf;
        }

        .bar, .box, .form-element, .form-element + label:before, .overlay-info, .thumbnail, .thumbnail .background-image, .thumbnail img, a, button, input, textarea {
            -webkit-transition-property: background, border-color, color, opacity, box-shadow, -webkit-transform;
            transition-property: background, border-color, color, opacity, box-shadow, transform;
            -webkit-transition-duration: .3s;
            transition-duration: .3s;
            -webkit-transition-timing-function: ease-in-out;
            transition-timing-function: ease-in-out;
        }

        a, p a {
            color: #666;
            outline: 0;
        }

            .box.dismissable .close, .box.dismissable .close:hover, .header .logo a, .shop .product-price ins, a, a:hover, p a, p a:hover {
                text-decoration: none;
            }

        a, button, input, select, textarea {
            touch-action: manipulation;
        }

        *, :after, :before {
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        /* a:-webkit-any-link {
            color: -webkit-link;
            cursor: pointer;
           text-decoration: underline;
        } */

        .center, .navigation.nav-center > ul {
            text-align: center;
        }

        body {
            font-family: 'Open Sans', 'Helvetica Neue', sans-serif;
            letter-spacing: 0;
            font-weight: 400;
            font-size: 1.4rem;
            line-height: 1.8;
            color: #666;
        }

        body {
            padding: 0;
            margin: 0;
            background: #fff;
            color: #666;
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-weight: 400;
            font-style: normal;
            font-size: 1.4rem;
            line-height: 1.8;
            overflow-x: hidden !important;
            overflow-y: scroll;
            -webkit-text-size-adjust: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html {
            font-size: 62.5%;
        }

        *, :after, :before {
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        *, :after, :before {
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        ::selection {
            background: #333;
            color: #fff;
        }

        .disabled {
            opacity: 0.6;
            background-color: #f4f4f4 !important;
            border-color: #eee !important;
            color: #999 !important;
        }

        .bkg-theme {
            background-color: goldenrod;
            color: white;
            border-color: lightgray;
        }

        .button.hard-shadow, button.hard-shadow {
            border-bottom: 3px solid rgba(0, 0, 0, .15);
        }

        .news-head {
            /*min-height: 350px;*/
            /* background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            width: 100%;*/
            /* border-radius: 10px 10px 0 0;*/
        }

        .video-image {
            background-image: url("img/videoImage.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 350px; /* ajusta a tu diseño */
            position: relative;
        }

    </style>

</head>
<body>

    <div class="preloader">
        <div class="loader">
            <div class="loader-outter"></div>
            <div class="loader-inner"></div>

            <div class="indicator">
                <svg width="16px" height="12px">
                    <polyline id="back" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                    <polyline id="front" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                </svg>
            </div>
        </div>
    </div>

    <header id="headerExplorar" class="header"> </header>
    <script>
        (async () => {

            await renderHeader('explorar', 'headerExplorar');
            await setUserData();
        })()
    </script>

    <section class="newsletter section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12  col-12">
                    <div class="subscribe-text">
                        <h6>Encuentra la entidad que andabas buscando</h6>
                        <!--<p class="">Descubre entidades cercanas.</p>-->
                    </div>

                </div>
                <br /><br /><br />
                <div class="col-lg-12 col-12">
                    <div class="">
                        <div class="">
                            <input id="textEntidad" name="textEntidad" placeholder="Buscar entidad" class="common-input" onfocus="this.placeholder = ''"
                                   onblur="this.placeholder = 'Buscar entidad'" type="text">
                            <button id="btnBuscarEntidad" class="btn" style=" margin: 0px 0px 0px 25px;" onclick="buscarUser()">BUSCAR</button>
                            <button id="btnFiltrar" class="btn" style=" margin: 0px 0px 0px 25px;" onclick="borrarBusqueda()">LIMPIAR</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <br /><br />

    <div class="container">
        <div class="col-12">
            <div class="button-group">
                <div class="row">
                    <button id="filtro1" onclick="aplicarFiltro1()" style=" width: 210px; font-size: 18px; }" href="#" class="button border-theme border-hover-theme color-theme color-hover-theme dashed">Comercio</button><br>
                    <button id="filtro2" onclick="aplicarFiltro2()" style=" width: 210px; font-size: 18px; }" href="#" class="button border-theme border-hover-theme color-theme color-hover-theme dashed">Asociación</button><br>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">

        function alternarEstiloFiltro(boton) {

            const clases_activo = ['bkg-theme', 'bkg-hover-theme', 'color-white', 'color-hover-white', 'shadow'];
            const clases_inactivo = ['border-theme', 'border-hover-theme', 'color-theme', 'color-hover-theme', 'dashed'];

            // Verificar si el botón ya tiene la clase principal de activo (bkg-theme)
            const estaActivo = boton.classList.contains('bkg-theme');

            if (estaActivo) {
                // Remover clases de activo
                clases_activo.forEach(clase => boton.classList.remove(clase));

                // Añadir clases de inactivo
                clases_inactivo.forEach(clase => boton.classList.add(clase));

            } else {
                // Remover clases de inactivo
                clases_inactivo.forEach(clase => boton.classList.remove(clase));

                // Añadir clases de activo
                clases_activo.forEach(clase => boton.classList.add(clase));
            }
        }

        // gestión estilos botones filtros
        document.addEventListener('DOMContentLoaded', () => {

            const filtro1 = document.getElementById('filtro1');
            const filtro2 = document.getElementById('filtro2');

            // Asignar el listener de clic a ambos botones
            filtro1.addEventListener('click', () => {
                alternarEstiloFiltro(filtro1);
            });

            filtro2.addEventListener('click', () => {
                alternarEstiloFiltro(filtro2);
            });
        });

    </script>

    <section class="blog section" id="blog">
        <div class="container">

            <div id="cardsPanel" class="row">

            </div>
        </div>
    </section>

    <script type="text/javascript">

        let filtros = null;

        document.addEventListener('DOMContentLoaded', () => {

            filtros = getInitialFilters();

            filtros.tiposActivos.forEach(tipo => {
                if (tipo === '64569dd3-4d65-4eed-9f41-ea87b2270a6c')
                    alternarEstiloFiltro(filtro1);

                if (tipo === 'e170a0db-660f-4c34-ae71-3e9b9dbbd92b')
                    alternarEstiloFiltro(filtro2);
            });

            document.getElementById('textEntidad').value = filtros.nombre;
            buscarEntidad();
        });

        function aplicarFiltro1() {

            toggleFiltroTipo('64569dd3-4d65-4eed-9f41-ea87b2270a6c', 'filtro1');
        }

        function aplicarFiltro2() {

            toggleFiltroTipo('e170a0db-660f-4c34-ae71-3e9b9dbbd92b', 'filtro2');
        }

        function toggleFiltroTipo(valorTipo, idBoton) {

            const index = filtros.tiposActivos.indexOf(valorTipo);

            if (index >= 0) {
                // Si ya está -> eliminar de la lista
                filtros.tiposActivos.splice(index, 1);
            } else {
                // Si no está -> añadir
                filtros.tiposActivos.push(valorTipo);
            }

            // Si no hay ninguno → tipo = null
            if (filtros.tiposActivos.length === 0) {
                filtros.tipo = null;
            }
            // Si hay 1 → tipo = ese
            else if (filtros.tiposActivos.length === 1) {
                filtros.tipo = filtros.tiposActivos[0];
            }
            // Si hay 2 → tipo = "all"
            else if (filtros.tiposActivos.length === 2) {
                filtros.tipo = "all";
            }

            buscarEntidad();
        }

        function getInitialFilters() {

            const params = new URLSearchParams(window.location.search);

            const filtrosIniciales = {
                nombre: params.get("name") || null,
                tipo: params.get("type") || null,
                tiposActivos: []
            };

            // Si viene un tipo por URL lo ponemos en la lista
            if (filtrosIniciales.tipo)
                filtrosIniciales.tiposActivos = [filtrosIniciales.tipo];

            return filtrosIniciales;
        }

        function buscarEntidad() {

            let contenedor = document.getElementById('cardsPanel');
            contenedor.innerHTML = '';

            GetEntidades()
                .then(entidades => {

                    entidades
                        .filter(entidad => entidad.activo)
                        .filter(entidad => {

                            if (filtros.nombre && !incluyeSubcadena(entidad.nombre, filtros.nombre)) {
                                return false;
                            }

                            if (filtros.tiposActivos.length > 0 &&
                                !filtros.tiposActivos.includes(entidad.idTipoEntidad)) {
                                return false;
                            }
                            return true;
                        })
                        .forEach(entidad => {
                            let card = crearCard(entidad.id, entidad.nombre, entidad.tipo, entidad.categoria, entidad.descripcion, entidad.imagen, entidad.ubicacion);
                            contenedor.appendChild(card);
                        });

                })
                .catch(error => {
                    console.error('Error en GetEntidades:', error);
                    alert('Error en GetEntidades');
                });
        }

        function buscarUser() {

            filtros.nombre = document.getElementById('textEntidad').value.trim() || null;
            buscarEntidad();
        }

        function borrarBusqueda() {

            document.getElementById('textEntidad').value = '';
            filtros.nombre = null;

            const botones = [
                { id: 'filtro1', valor: '64569dd3-4d65-4eed-9f41-ea87b2270a6c' },
                { id: 'filtro2', valor: 'e170a0db-660f-4c34-ae71-3e9b9dbbd92b' }
            ];

            // Desactivar todos los botones que estén activos
            botones.forEach(b => {
                if (filtros.tiposActivos.includes(b.valor)) {
                    alternarEstiloFiltro(document.getElementById(b.id));
                }
            });

            filtros.tipo = null;
            filtros.tiposActivos = [];

            buscarEntidad();
        }

        function incluyeSubcadena(principal, subcadena) {
            return principal.toLowerCase().includes(subcadena.toLowerCase());
        }

        function crearCard(id, nombre, tipo, categoria, descripcion, imagen, ubicacion) {

            const divCol = document.createElement('div');
            divCol.id = id;

            divCol.addEventListener("click", function () {

                window.location.href = `landing-entidad.html?id=${encodeURIComponent(id)}`;
            });

            divCol.className = 'col-lg-4 col-md-6 col-12';

            const divSingleNews = document.createElement('div');
            divSingleNews.className = 'single-news';

            const divNewsHead = document.createElement('div');
            divNewsHead.className = 'news-head';

            const img = document.createElement('img');
            img.src = 'img/entidades/' + imagen;
            img.alt = '#';
            img.style.minHeight = "235px";

            const divNewsBody = document.createElement('div');
            divNewsBody.className = 'news-body';

            const divNewsContent = document.createElement('div');
            divNewsContent.className = 'news-content';

            const divDate = document.createElement('div');
            divDate.className = 'date';
            divDate.textContent = ubicacion;

            const h2 = document.createElement('h2');
            const a = document.createElement('a');
            //a.href = 'blog-single.html';
            a.href = `landing-entidad.html?id=${encodeURIComponent(id)}`;
            a.textContent = nombre;
            h2.appendChild(a);

            const p = document.createElement('p');
            p.className = 'text';
            p.textContent = descripcion.slice(0, 300);;

            //
            divNewsContent.appendChild(divDate);
            divNewsContent.appendChild(h2);
            divNewsContent.appendChild(p);

            divNewsBody.appendChild(divNewsContent);

            divNewsHead.appendChild(img);

            divSingleNews.appendChild(divNewsHead);
            divSingleNews.appendChild(divNewsBody);

            divCol.appendChild(divSingleNews);

            return divCol;
        }

    </script>

    <section class="why-choose section">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-12">
                    <div class="choose-left">
                        <h3>¿Cómo interactuar con las entidades?</h3>
                        <p style="color: black;">
                            Descubre entidades locales, conoce sus servicios y explora las actividades que ofrecen desde un único espacio digital.
                        </p> 
                        <p style="color: black;">
                            Interactúa fácilmente reservando actividades, accediendo a promociones y participando en iniciativas pensadas para la comunidad.
                        </p> 
                        <div class="row">
                            <div class="col-lg-12">
                                <ul class="list">
                                    <li><i class="fa fa-caret-right"></i>Descubre entidades y consulta sus actividades y productos.</li>
                                    <li><i class="fa fa-caret-right"></i>Reserva actividades y participa directamente desde la plataforma.</li>
                                    <li><i class="fa fa-caret-right"></i>Escanea códigos QR para obtener puntos, recompensas y ventajas exclusivas.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-12">
                    <div class="choose-right">
                        <div class="video-image">
                            <div class="promo-video">
                                <div class="waves-block">
                                    <div class="waves wave-1"></div>
                                    <div class="waves wave-2"></div>
                                    <div class="waves wave-3"></div>
                                </div>
                            </div>
                            <a href="https://www.youtube-nocookie.com/embed/h0DJkZEgZpA?autoplay=1&rel=0" class="video video-popup mfp-iframe"><i class="fa fa-play"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="portfolio section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title">
                        <h2>Encuentra las entidades mejor valoradas</h2>
                        <img style="padding: 15px;" src="img/logo.jpg" alt="#">
                        <p style="padding-bottom: 15px;">Consulta las opiniones de otros usuarios y descubre qué entidades destacan por su calidad y servicio cercano.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-12">
                    <div class="owl-carousel portfolio-slider">
                        <div class="single-pf">
                            <img style="height: 300px;" src="img/fotos/foto1.jpg" alt="#">
                            <a href="#" class="btn">Ver más</a>
                        </div>
                        <div class="single-pf">
                            <img style="height: 300px;" src="img/fotos/foto10.jpg" alt="#">
                            <a href="explorar.html" class="btn">Ver más</a>
                        </div>
                        <div class="single-pf">
                            <img style="height: 300px;" src="img/fotos/foto11.jpg" alt="#">
                            <a href="explorar.html" class="btn">Ver más</a>
                        </div>
                        <div class="single-pf">
                            <img style="height: 300px;" src="img/fotos/foto14.jpg" alt="#">
                            <a href="explorar.html" class="btn">Ver más</a>
                        </div>
                        <div class="single-pf">
                            <img style="height: 300px;" src="img/fotos/foto3.jpg" alt="#">
                            <a href="explorar.html" class="btn">Ver más</a>
                        </div>
                        <div class="single-pf">
                            <img style="height: 300px;" src="img/fotos/foto2.jpg" alt="#">
                            <a href="explorar.html" class="btn">Ver más</a>
                        </div>
                        <div class="single-pf">
                            <img style="height: 300px;" src="img/fotos/foto15.jpg" alt="#">
                            <a href="explorar.html" class="btn">Ver más</a>
                        </div>
                        <div class="single-pf">
                            <img style="height: 300px;" src="img/fotos/foto7.jpg" alt="#">
                            <a href="explorar.html" class="btn">Ver más</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer id="footer" class="footer"></footer>
    <script>
        (async () => {
            await renderFooter('footer');
        })()
    </script>

    <script src="./js/jquery.min.js"></script>
    <script src="./js/jquery-migrate-3.0.0.js"></script>
    <script src="./js/jquery-ui.min.js"></script>
    <script src="./js/easing.js"></script>
    <script src="./js/colors.js"></script>
    <script src="./js/popper.min.js"></script>
    <script src="./js/bootstrap-datepicker.js"></script>
    <script src="./js/jquery.nav.js"></script>
    <script src="./js/slicknav.min.js"></script>
    <script src="./js/jquery.scrollUp.min.js"></script>
    <script src="./js/niceselect.js"></script>
    <script src="./js/tilt.jquery.min.js"></script>
    <script src="./js/owl-carousel.js"></script>
    <script src="./js/jquery.counterup.min.js"></script>
    <script src="./js/steller.js"></script>
    <script src="./js/wow.min.js"></script>
    <script src="./js/jquery.magnific-popup.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.3/waypoints.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./js/main.js"></script>
</body>
</html>